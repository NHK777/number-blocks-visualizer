<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数値ブロック比較表示</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            /* 薄いグレーの背景 */
        }

        .page-container {
            /* ページ全体のコンテナ */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            /* 24px */
            padding: 1rem;
            /* 16px */
            width: 100%;
        }

        .main-title {
            font-size: 1.875rem;
            /* 30px */
            font-weight: bold;
            color: #111827;
            /* gray-900 */
            margin-bottom: 0.5rem;
            /* 8px */
        }

        .clear-button-container {
            margin-bottom: 1.5rem;
            /* 24px */
            width: 100%;
            max-width: 80rem;
            /* comparison-container と同じ幅に合わせる */
            display: flex;
            justify-content: center;
            /* ボタンを中央に配置 */
        }

        .clear-button {
            background-color: #ef4444;
            /* red-500 */
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            /* 12px 24px */
            border-radius: 0.5rem;
            /* 8px */
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }

        .clear-button:hover {
            background-color: #dc2626;
            /* red-600 */
        }


        .comparison-container {
            display: flex;
            flex-direction: column;
            /* モバイルでは縦積み */
            gap: 1.5rem;
            /* 24px */
            width: 100%;
            max-width: 80rem;
            /* 1280px, 2つのビューアを並べるため広めに */
        }

        @media (min-width: 1024px) {

            /* lgブレークポイント以上で横並び */
            .comparison-container {
                flex-direction: row;
            }
        }

        .viewer-column {
            background-color: white;
            padding: 1.5rem;
            /* 24px */
            border-radius: 0.75rem;
            /* 12px */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 100%;
            /* モバイルでは全幅 */
        }

        @media (min-width: 1024px) {
            .viewer-column {
                width: calc(50% - 0.75rem);
                /* ギャップを考慮した幅 */
            }
        }

        .viewer-title {
            font-size: 1.5rem;
            /* 24px */
            font-weight: bold;
            text-align: center;
            margin-bottom: 1.5rem;
            /* 24px */
            color: #1f2937;
            /* gray-800 */
        }

        .blocks-display-area {
            min-height: 280px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 0.5rem;
            /* 8px */
            margin-bottom: 1.5rem;
            /* 24px */
            padding: 0.75rem;
            /* 12px */
            border: 1px solid #d1d5db;
            /* gray-300 */
            border-radius: 0.5rem;
            /* 8px */
            background-color: #f9fafb;
            /* gray-50 */
        }

        .digit-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 10px;
            border: 1px solid #e5e7eb;
            /* gray-200 */
            border-radius: 8px;
            background-color: #f9fafb;
            /* gray-50 */
            min-height: 240px;
            box-sizing: border-box;
        }

        .hundreds-col-width {
            width: 50%;
        }

        .tens-col-width {
            width: 23%;
        }

        .ones-col-width {
            width: 23%;
        }


        .digit-label {
            font-size: 0.875rem;
            /* 14px */
            color: #4b5563;
            /* gray-600 */
            font-weight: 500;
            text-align: center;
            margin-bottom: 4px;
        }

        .blocks-container {
            width: 100%;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            box-sizing: border-box;
            overflow: hidden;
            padding: 4px;
        }

        .zero-display {
            font-size: 3rem;
            font-weight: bold;
            color: #9ca3af;
            /* gray-400 */
            line-height: 1;
            margin: auto;
        }

        .digit-content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            width: 100%;
            transform-origin: top center;
            transition: transform 0.1s ease-out;
        }

        .hundreds-unit {
            width: 60px;
            height: 60px;
            background-color: #fee2e2;
            /* red-100 */
            border: 1px solid #fca5a5;
            /* red-300 */
            border-radius: 4px;
            padding: 2px;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 1px;
            box-sizing: border-box;
        }

        .small-block-hundreds {
            background-color: #ef4444;
            /* red-500 */
            border-radius: 1px;
        }

        .tens-unit {
            width: 14px;
            height: 90px;
            background-color: #dbeafe;
            /* blue-100 */
            border: 1px solid #93c5fd;
            /* blue-300 */
            border-radius: 4px;
            padding: 2px;
            display: flex;
            flex-direction: column;
            gap: 1px;
            align-items: center;
            box-sizing: border-box;
        }

        .small-block-tens {
            width: 8px;
            height: 8px;
            background-color: #3b82f6;
            /* blue-500 */
            border-radius: 1px;
        }

        .ones-unit {
            width: 22px;
            height: 22px;
            background-color: #dcfce7;
            /* green-100 薄い緑 */
            border: 1px solid #86efac;
            /* green-300 やや薄い緑 */
            border-radius: 4px;
            padding: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }

        .small-block-ones {
            width: 14px;
            height: 14px;
            background-color: #22c55e;
            /* green-500 濃い緑 */
            border-radius: 2px;
        }


        .hundreds-wrapper,
        .tens-wrapper,
        .ones-wrapper {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
            width: auto;
        }

        .block-row {
            display: flex;
            justify-content: flex-start;
            gap: 8px;
            width: auto;
        }

        .ones-wrapper {
            /* (新しい .ones-unit 幅22px * 5) + (ギャップ8px * 4) = 110px + 32px = 142px */
        }


        .input-label {
            display: block;
            font-size: 0.875rem;
            /* 14px */
            font-weight: medium;
            color: #374151;
            /* gray-700 */
            margin-bottom: 0.25rem;
            /* 4px */
        }

        .number-input-field {
            margin-top: 0.25rem;
            /* 4px */
            display: block;
            width: 100%;
            padding: 0.5rem 0.75rem;
            /* 8px 12px */
            background-color: white;
            border: 1px solid #d1d5db;
            /* gray-300 */
            border-radius: 0.375rem;
            /* 6px */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .error-message-text {
            color: #ef4444;
            /* red-500 */
            font-size: 0.75rem;
            /* 12px */
            margin-top: 0.25rem;
            /* 4px */
            height: 20px;
            /* 高さを確保 */
        }

        .helper-text {
            font-size: 0.75rem;
            /* 12px */
            color: #6b7280;
            /* gray-500 */
            text-align: center;
            margin-top: 1.5rem;
            /* 24px */
        }
    </style>
</head>

<body>
    <div class="page-container">
        <h1 class="main-title">数値ブロック比較</h1>
        <div class="clear-button-container">
            <button id="clearAllButton" class="clear-button">全ての入力をクリア</button>
        </div>

        <div class="comparison-container">
            <div class="viewer-column">
                <h2 class="viewer-title">入力 1</h2>
                <div class="blocks-display-area">
                    <div class="digit-group hundreds-col-width">
                        <span class="digit-label">百の位</span>
                        <div id="hundredsBlocksContainerLeft" class="blocks-container"></div>
                    </div>
                    <div class="digit-group tens-col-width">
                        <span class="digit-label">十の位</span>
                        <div id="tensBlocksContainerLeft" class="blocks-container"></div>
                    </div>
                    <div class="digit-group ones-col-width">
                        <span class="digit-label">一の位</span>
                        <div id="onesBlocksContainerLeft" class="blocks-container"></div>
                    </div>
                </div>
                <div>
                    <label for="numberInputLeft" class="input-label">3桁の数値を入力:</label>
                    <input type="tel" id="numberInputLeft" inputmode="numeric" pattern="[0-9]*" maxlength="3"
                        class="number-input-field">
                    <p id="errorMessageLeft" class="error-message-text"></p>
                </div>
                <p class="helper-text">入力された数値の各桁に対応するブロックが表示されます。</p>
            </div>

            <div class="viewer-column">
                <h2 class="viewer-title">入力 2</h2>
                <div class="blocks-display-area">
                    <div class="digit-group hundreds-col-width">
                        <span class="digit-label">百の位</span>
                        <div id="hundredsBlocksContainerRight" class="blocks-container"></div>
                    </div>
                    <div class="digit-group tens-col-width">
                        <span class="digit-label">十の位</span>
                        <div id="tensBlocksContainerRight" class="blocks-container"></div>
                    </div>
                    <div class="digit-group ones-col-width">
                        <span class="digit-label">一の位</span>
                        <div id="onesBlocksContainerRight" class="blocks-container"></div>
                    </div>
                </div>
                <div>
                    <label for="numberInputRight" class="input-label">3桁の数値を入力:</label>
                    <input type="tel" id="numberInputRight" inputmode="numeric" pattern="[0-9]*" maxlength="3"
                        class="number-input-field">
                    <p id="errorMessageRight" class="error-message-text"></p>
                </div>
                <p class="helper-text">入力された数値の各桁に対応するブロックが表示されます。</p>
            </div>
        </div>
    </div>

    <script>
        /**
         * 指定されたコンテナに、数値に応じたブロックを生成して表示します。
         * @param {HTMLElement} mainContainer - ブロックを表示するメインのコンテナ要素。
         * @param {number} count - 表示するブロック/ユニットの数。
         * @param {string} digitType - 桁の種類 ('hundreds', 'tens', 'ones')。
         */
        function generateDigitBlocks(mainContainer, count, digitType) {
            // コンテナの既存の内容をクリアし、スタイルをリセット
            mainContainer.innerHTML = '';
            mainContainer.style.display = '';
            mainContainer.style.alignItems = '';
            mainContainer.style.justifyContent = '';

            // 表示する数が0の場合、大きな「0」を表示して終了
            if (count === 0) {
                const zeroDisplay = document.createElement('div');
                zeroDisplay.className = 'zero-display';
                zeroDisplay.textContent = '0';
                mainContainer.appendChild(zeroDisplay);
                // 「0」をコンテナの中央に配置するためのスタイル設定
                mainContainer.style.display = 'flex';
                mainContainer.style.alignItems = 'center';
                mainContainer.style.justifyContent = 'center';
                return;
            }

            // ブロック群全体をラップし、スケーリングの対象となるコンテナ
            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'digit-content-wrapper';

            // 各桁のブロック/ユニットを行ごとにまとめるためのラッパー
            let specificWrapper = document.createElement('div');
            let currentRow = null; // 現在の行要素を保持
            const itemsPerRow = 5; // 1行に表示するアイテムの最大数

            // 桁の種類に応じてブロック/ユニットを生成
            if (digitType === 'hundreds') {
                specificWrapper.className = 'hundreds-wrapper'; // 百の位用のラッパークラス
                for (let i = 0; i < count; i++) {
                    // 5個ごとに新しい行を開始
                    if (i % itemsPerRow === 0) {
                        currentRow = document.createElement('div');
                        currentRow.className = 'block-row'; // 行用のクラス
                        specificWrapper.appendChild(currentRow);
                    }
                    // 10x10のフラットユニットを生成
                    const unit = document.createElement('div');
                    unit.className = 'hundreds-unit';
                    for (let j = 0; j < 100; j++) { // 100個の小ブロックを生成
                        const smallBlock = document.createElement('div');
                        smallBlock.className = 'small-block-hundreds';
                        unit.appendChild(smallBlock);
                    }
                    currentRow.appendChild(unit); // 現在の行にユニットを追加
                }
            } else if (digitType === 'tens') {
                specificWrapper.className = 'tens-wrapper'; // 十の位用のラッパークラス
                for (let i = 0; i < count; i++) {
                    if (i % itemsPerRow === 0) {
                        currentRow = document.createElement('div');
                        currentRow.className = 'block-row';
                        specificWrapper.appendChild(currentRow);
                    }
                    // 縦1x10のロッドユニットを生成
                    const unit = document.createElement('div');
                    unit.className = 'tens-unit';
                    for (let j = 0; j < 10; j++) { // 10個の小ブロックを生成
                        const smallBlock = document.createElement('div');
                        smallBlock.className = 'small-block-tens';
                        unit.appendChild(smallBlock);
                    }
                    currentRow.appendChild(unit);
                }
            } else if (digitType === 'ones') {
                specificWrapper.className = 'ones-wrapper'; // 一の位用のラッパークラス
                for (let i = 0; i < count; i++) {
                    if (i % itemsPerRow === 0) {
                        currentRow = document.createElement('div');
                        currentRow.className = 'block-row';
                        specificWrapper.appendChild(currentRow);
                    }
                    // 一の位のユニット（小ブロックを1つ含む）を生成
                    const unit = document.createElement('div');
                    unit.className = 'ones-unit';
                    const smallBlock = document.createElement('div');
                    smallBlock.className = 'small-block-ones';
                    unit.appendChild(smallBlock);
                    currentRow.appendChild(unit);
                }
            }

            // 生成された各桁のラッパーをスケーリング用ラッパーに追加
            contentWrapper.appendChild(specificWrapper);
            // スケーリング用ラッパーをメインコンテナに追加
            mainContainer.appendChild(contentWrapper);

            // DOM描画後にスケーリング処理を実行
            requestAnimationFrame(() => {
                // メインコンテナの利用可能な幅と高さを取得 (paddingを考慮)
                const availableWidth = mainContainer.clientWidth - parseFloat(getComputedStyle(mainContainer).paddingLeft) - parseFloat(getComputedStyle(mainContainer).paddingRight);
                const availableHeight = mainContainer.clientHeight - parseFloat(getComputedStyle(mainContainer).paddingTop) - parseFloat(getComputedStyle(mainContainer).paddingBottom);

                // スケーリング対象のコンテンツの実際の幅と高さを取得
                const contentWidth = specificWrapper.scrollWidth;
                const contentHeight = specificWrapper.scrollHeight;

                let scaleFactor = 1; // 初期スケール係数

                // コンテンツが利用可能領域を超える場合にスケール係数を計算
                const needsHorizontalScale = contentWidth > availableWidth;
                const needsVerticalScale = contentHeight > availableHeight;

                if (needsHorizontalScale || needsVerticalScale) {
                    const scaleX = (needsHorizontalScale && availableWidth > 0 && contentWidth > 0) ? availableWidth / contentWidth : 1;
                    const scaleY = (needsVerticalScale && availableHeight > 0 && contentHeight > 0) ? availableHeight / contentHeight : 1;
                    scaleFactor = Math.min(scaleX, scaleY, 1); // 縦横で小さい方のスケールを採用し、1を超えないようにする
                }

                // 極端に小さくなりすぎないように最小スケールを設定
                scaleFactor = Math.max(scaleFactor, 0.1);

                // 計算されたスケールを適用 (1未満の場合のみ)
                if (scaleFactor < 1) {
                    contentWrapper.style.transform = `scale(${scaleFactor})`;
                } else {
                    contentWrapper.style.transform = 'scale(1)'; // スケーリング不要な場合は等倍
                }
            });
        }

        /**
         * 指定されたプレフィックスを持つ数値ブロックビューアのインスタンスを初期化します。
         * @param {string} instancePrefix - HTML要素のIDに使われるプレフィックス ('Left' または 'Right')。
         * @returns {object} このインスタンスに関連するHTML要素のオブジェクト。
         */
        function initializeViewer(instancePrefix) {
            // 各インスタンスのHTML要素を取得
            const elements = {
                numberInput: document.getElementById(`numberInput${instancePrefix}`),
                hundredsContainer: document.getElementById(`hundredsBlocksContainer${instancePrefix}`),
                tensContainer: document.getElementById(`tensBlocksContainer${instancePrefix}`),
                onesContainer: document.getElementById(`onesBlocksContainer${instancePrefix}`),
                errorMessageElement: document.getElementById(`errorMessage${instancePrefix}`)
            };

            /**
             * このインスタンスのブロック表示を更新します。
             * @param {string} value - 入力フィールドの値。
             */
            function updateInstanceBlocks(value) {
                elements.errorMessageElement.textContent = ''; // エラーメッセージをクリア

                // 入力が空の場合、全てのブロックをクリアして0を表示
                if (value === '') {
                    elements.hundredsContainer.innerHTML = '';
                    elements.tensContainer.innerHTML = '';
                    elements.onesContainer.innerHTML = '';
                    generateDigitBlocks(elements.hundredsContainer, 0, 'hundreds');
                    generateDigitBlocks(elements.tensContainer, 0, 'tens');
                    generateDigitBlocks(elements.onesContainer, 0, 'ones');
                    return;
                }

                // 入力値のバリデーション (1〜3桁の数値か)
                if (!/^\d{1,3}$/.test(value)) {
                    elements.errorMessageElement.textContent = '1桁から3桁の数値を入力してください。';
                    // エラー時はブロックをクリアして0を表示
                    elements.hundredsContainer.innerHTML = '';
                    elements.tensContainer.innerHTML = '';
                    elements.onesContainer.innerHTML = '';
                    generateDigitBlocks(elements.hundredsContainer, 0, 'hundreds');
                    generateDigitBlocks(elements.tensContainer, 0, 'tens');
                    generateDigitBlocks(elements.onesContainer, 0, 'ones');
                    return;
                }

                const number = parseInt(value, 10); // 文字列を数値に変換

                // 数値の範囲バリデーション (0〜999)
                if (isNaN(number) || number < 0 || number > 999) {
                    elements.errorMessageElement.textContent = '0から999までの数値を入力してください。';
                    elements.hundredsContainer.innerHTML = '';
                    elements.tensContainer.innerHTML = '';
                    elements.onesContainer.innerHTML = '';
                    generateDigitBlocks(elements.hundredsContainer, 0, 'hundreds');
                    generateDigitBlocks(elements.tensContainer, 0, 'tens');
                    generateDigitBlocks(elements.onesContainer, 0, 'ones');
                    return;
                }

                // 各桁の数を計算
                const hundreds = Math.floor(number / 100);
                const tens = Math.floor((number % 100) / 10);
                const ones = number % 10;

                // 各桁のブロックを生成・表示
                generateDigitBlocks(elements.hundredsContainer, hundreds, 'hundreds');
                generateDigitBlocks(elements.tensContainer, tens, 'tens');
                generateDigitBlocks(elements.onesContainer, ones, 'ones');
            }

            // 入力フィールドのinputイベントにリスナーを設定
            elements.numberInput.addEventListener('input', () => {
                updateInstanceBlocks(elements.numberInput.value);
            });

            // 初期表示（"0"で初期化して0のブロックを表示）
            updateInstanceBlocks("0");
            return elements; // クリアボタン機能のために要素の参照を返す
        }

        // 左右両方のビューアを初期化
        const viewerLeftElements = initializeViewer('Left');
        const viewerRightElements = initializeViewer('Right');

        // 「全ての入力をクリア」ボタンの要素を取得
        const clearAllButton = document.getElementById('clearAllButton');
        // クリアボタンのクリックイベントにリスナーを設定
        clearAllButton.addEventListener('click', () => {
            // 左側のビューアをクリア
            viewerLeftElements.numberInput.value = ''; // 入力フィールドを空にする
            // 各桁のブロックコンテナをクリアし、0のブロックを再描画
            viewerLeftElements.hundredsContainer.innerHTML = '';
            viewerLeftElements.tensContainer.innerHTML = '';
            viewerLeftElements.onesContainer.innerHTML = '';
            generateDigitBlocks(viewerLeftElements.hundredsContainer, 0, 'hundreds');
            generateDigitBlocks(viewerLeftElements.tensContainer, 0, 'tens');
            generateDigitBlocks(viewerLeftElements.onesContainer, 0, 'ones');
            viewerLeftElements.errorMessageElement.textContent = ''; // エラーメッセージをクリア

            // 右側のビューアをクリア (同様の処理)
            viewerRightElements.numberInput.value = '';
            viewerRightElements.hundredsContainer.innerHTML = '';
            viewerRightElements.tensContainer.innerHTML = '';
            viewerRightElements.onesContainer.innerHTML = '';
            generateDigitBlocks(viewerRightElements.hundredsContainer, 0, 'hundreds');
            generateDigitBlocks(viewerRightElements.tensContainer, 0, 'tens');
            generateDigitBlocks(viewerRightElements.onesContainer, 0, 'ones');
            viewerRightElements.errorMessageElement.textContent = '';
        });

    </script>

</body>

</html>
